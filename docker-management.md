–û—Ç–ª–∏—á–Ω–æ, Akrom üî• ‚Äî —É —Ç–µ–±—è —É–∂–µ –ø–æ—á—Ç–∏ ‚Äú–ø—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤—ã–π‚Äù Docker setup –¥–ª—è Django —Å Celery, Redis, PostgreSQL —á–µ—Ä–µ–∑ pgbouncer, –∏ –¥–∞–∂–µ Flower –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º **–ª–æ–≥–∏–∫—É –≤—Å–µ–≥–æ —Ç–≤–æ–µ–≥–æ —Å—Ç–µ–∫–∞**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª, –∫–∞–∫ —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.

---

## 1Ô∏è‚É£ –õ–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### **web (Django)**

* –°—Ç–∞—Ä—Ç—É–µ—Ç —á–µ—Ä–µ–∑ `/start` —Å–∫—Ä–∏–ø—Ç.
* –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

  1. `migrate` (–ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î)
  2. `collectstatic` (—Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã)
  3. –ó–∞–ø—É—Å–∫–∞–µ—Ç ASGI —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `uvicorn` (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Gunicorn –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
* –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫:

  * **Redis** (–∫–µ—à, –±—Ä–æ–∫–µ—Ä Celery)
  * **pgbouncer ‚Üí PostgreSQL** (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î)
* **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞:**

  * –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gunicorn —Å `uvicorn` –≤–æ—Ä–∫–µ—Ä–∞–º–∏:

    ```bash
    gunicorn core.asgi:application -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 --workers 4 --timeout 120
    ```

    –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---

### **db (PostgreSQL)**

* –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ.
* volume `pg_data` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
* healthcheck –∂–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º pgbouncer –∏ web.
* **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

  * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã pool_size, max_connections –¥–ª—è PostgreSQL –∏ pgbouncer.
  * –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ë–î (–∏–ª–∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Å–µ—Ä–≤–∏—Å) –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

### **pgbouncer**

* –õ—ë–≥–∫–∏–π connection pool –¥–ª—è PostgreSQL.
* –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `db`, –æ—Ç–¥–∞—ë—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞–º.
* **–ü–ª—é—Å—ã:**

  * –£–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ PostgreSQL –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö.
  * –ú–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Ä–∫–µ—Ä—ã Django –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.
* **–ü—Ä–æ–¥–∞–∫—à–Ω:** –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å TLS –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å max_client_conn.

---

### **redis**

* –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—Ä–æ–∫–µ—Ä –¥–ª—è Celery.
* –í–∞–∂–µ–Ω –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

  * Django caching
  * Celery –±—Ä–æ–∫–µ—Ä
* **–ü—Ä–æ–¥–∞–∫—à–Ω:** –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π Redis —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ managed Redis –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

### **celery_worker, celery_beat**

* **Worker:** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ email, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –∏ —Ç.–¥.)
* **Beat:** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á.
* –°–∫—Ä–∏–ø—Ç—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –ø–æ—Å–ª–µ `sleep` 10 —Å–µ–∫, —á—Ç–æ–±—ã RabbitMQ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω) –∏ Redis –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã.
* **–ü—Ä–æ–¥–∞–∫—à–Ω:**

  * –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ worker –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (`-c 4` –∏–ª–∏ –±–æ–ª—å—à–µ, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç CPU)
  * –í–∫–ª—é—á–∏—Ç—å `--max-tasks-per-child` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

---

### **celery-flower**

* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ—Ä—Ç—É 5555.
* –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å –≤ –ø—Ä–æ–¥–µ, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø.

---

## 2Ô∏è‚É£ –õ–æ–≥–∏–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤

### **entrypoint**

* –ñ–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL (`postgres_ready()`)
* –ü–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É, –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (`exec "$@"`)

### **start**

* Django:

  1. `migrate`
  2. `collectstatic`
  3. –ó–∞–ø—É—Å–∫ ASGI —á–µ—Ä–µ–∑ uvicorn (–∏–ª–∏ Gunicorn)
* –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –ª—É—á—à–µ Gunicorn + Uvicorn worker.

### **Celery start scripts**

* Worker, Beat, Flower –∂–¥—É—Ç RabbitMQ/Redis (`sleep 10`), —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
* –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã.

---

## 3Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è production

1. **Gunicorn –≤–º–µ—Å—Ç–æ Uvicorn –≤ `start`:**

   ```bash
   gunicorn core.asgi:application \
       -k uvicorn.workers.UvicornWorker \
       --bind 0.0.0.0:8000 \
       --workers 4 \
       --timeout 120 \
       --log-level info
   ```

   * –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev –∏ prod Dockerfile**

   * –î–ª—è dev: `--reload` uvicorn
   * –î–ª—è prod: Gunicorn + no reload + –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

3. **Volumes**

   * –ù–µ –≤–∫–ª—é—á–∞—Ç—å —Å—Ç–∞—Ç–∏–∫—É –∏ –º–µ–¥–∏–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏, —á—Ç–æ–±—ã Docker –∫—ç—à–∏—Ä–æ–≤–∞–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
   * `.dockerignore` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî –æ—Ç–ª–∏—á–Ω–æ.

4. **Environment**

   * –û—Ç–¥–µ–ª—å–Ω—ã–µ `.env` –¥–ª—è dev –∏ prod
   * –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ Dockerfile

5. **Celery**

   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å concurrency:

     ```bash
     celery -A core worker -l info -c 4 --max-tasks-per-child=100
     ```
   * Beat scheduler: —Ö—Ä–∞–Ω–∏—Ç—å PID –≤ volume, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

6. **Healthchecks**

   * –î–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (web, db, redis) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å healthcheck, —á—Ç–æ–±—ã Docker –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª –ø–∞–¥–µ–Ω–∏–µ

7. **Logging**

   * Gunicorn + Nginx –ª–æ–≥–∏ –≤ stdout/stderr ‚Üí Docker logging driver ‚Üí —É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

8. **Reverse proxy (Nginx)**

   * –ï—Å–ª–∏ Nginx —á–µ—Ä–µ–∑ Docker: `depends_on: web`, volume –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
   * SSL —á–µ—Ä–µ–∑ LetsEncrypt

---

## 4Ô∏è‚É£ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

* **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö:**

  ```bash
  docker compose up -d
  ```
* **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö:**

  ```bash
  docker compose restart
  ```
* **–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**

  ```bash
  docker compose down
  ```
* **–°–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**

  ```bash
  docker compose logs -f web
  docker compose logs -f celery_worker
  ```
* **–í–æ–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**

  ```bash
  docker exec -it django_app bash
  ```
* **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**

  ```bash
  docker compose ps
  ```

---

## 5Ô∏è‚É£ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker –¥–ª—è –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏

```
Backend/
‚îú‚îÄ deployments/compose/django/
‚îÇ  ‚îú‚îÄ Dockerfile       # –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–ª—è dev/prod
‚îÇ  ‚îú‚îÄ entrypoint       # –∂–¥—ë—Ç –ë–î
‚îÇ  ‚îú‚îÄ start            # –∑–∞–ø—É—Å–∫ Gunicorn/uvicorn
‚îÇ  ‚îî‚îÄ celery/          # worker/beat/flower scripts
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ .env
‚îú‚îÄ requirements.txt
‚îú‚îÄ app/                 # Django project
‚îú‚îÄ assets/
‚îÇ  ‚îú‚îÄ staticfiles/
‚îÇ  ‚îî‚îÄ media/
‚îî‚îÄ .dockerignore
```

* Dev: uvicorn `--reload`
* Prod: Gunicorn + Uvicorn worker
* `.dockerignore` —É–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏
* Healthchecks + volumes –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
* –õ–æ–≥–∏ –≤ stdout/stderr ‚Üí –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å monitoring

---

üí° **–ì–ª–∞–≤–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:**

1. Gunicorn –≤–º–µ—Å—Ç–æ `uvicorn --reload`
2. Concurrency Celery –∏ max-tasks-per-child
3. Healthchecks –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. –û—Ç–¥–µ–ª—å–Ω—ã–π volume –¥–ª—è –ë–î, —Å—Ç–∞—Ç–∏–∫–∏ –∏ –º–µ–¥–∏–∞
5. SSL + Nginx reverse proxy
6. –õ–æ–≥–∏ —á–µ—Ä–µ–∑ Docker (–±–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
7. `.env` –æ—Ç–¥–µ–ª—å–Ω–æ, —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ Dockerfile

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å **–ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–≤–æ–π Dockerfile, start/entrypoint –∏ docker-compose.yml**, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª **–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –ø—Ä–æ–¥–∞–∫—à–Ω**, —Å Gunicorn, Celery, Redis, PostgreSQL —á–µ—Ä–µ–∑ pgbouncer, Nginx –∏ SSL-ready, –ø—Ä–∏ —ç—Ç–æ–º –∫–æ–¥ —Å—Ç–∞–ª **—á–∏—Ç–∞–µ–º—ã–º –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º**.

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è —Å–¥–µ–ª–∞–ª —ç—Ç–æ?
